# Work Completion Publisher Interface

## Public API Definition

This module provides autonomous work completion detection and publishing to git and social media platforms.

### Class: WorkAnalyzer

**Purpose**: Analyzes 0102 work sessions using Qwen intelligence to determine publishing worthiness.

#### Constructor
```python
WorkAnalyzer(project_root: Optional[Path] = None) -> WorkAnalyzer
```
**Parameters**:
- `project_root` (Path, optional): Project root directory. Defaults to auto-detected.

**Returns**: Configured WorkAnalyzer instance

#### evaluate_current_session() -> Tuple[bool, Optional[PublishContent]]
**Purpose**: Evaluate current work session for publishing significance.

**Returns**: Tuple of (should_publish, content)
- `should_publish` (bool): Whether work is significant enough to publish
- `content` (PublishContent or None): Generated content if should publish

**Example**:
```python
analyzer = WorkAnalyzer()
should_publish, content = await analyzer.evaluate_current_session()

if should_publish:
    print(f"Significant work detected: {content.commit_message}")
```

#### publish(content: PublishContent) -> bool
**Purpose**: Execute publishing to git and social media.

**Parameters**:
- `content` (PublishContent): Content generated by evaluate_current_session

**Returns**: True if successful, False otherwise

**Example**:
```python
success = await analyzer.publish(content)
if success:
    print("Published to git, LinkedIn, and X/Twitter")
```

### Class: MonitoringService

**Purpose**: Background service for continuous work monitoring and auto-publishing.

#### Constructor
```python
MonitoringService(
    check_interval_seconds: int = 300,
    auto_publish: bool = True
) -> MonitoringService
```

**Parameters**:
- `check_interval_seconds` (int): Seconds between checks. Default 300 (5 minutes)
- `auto_publish` (bool): Whether to auto-publish or just notify. Default True

#### start() -> None
**Purpose**: Start continuous monitoring loop.

**Example**:
```python
service = MonitoringService(check_interval_seconds=300, auto_publish=True)
await service.start()  # Runs until stopped
```

#### stop() -> None
**Purpose**: Stop monitoring service.

#### get_stats() -> Dict[str, Any]
**Purpose**: Get monitoring statistics.

**Returns**: Dict containing:
- `is_running` (bool): Whether service is active
- `checks_performed` (int): Number of checks completed
- `publications_made` (int): Number of successful publications
- `last_check_time` (str): ISO timestamp of last check

### Global Functions

#### start_monitoring(check_interval: int = 300, auto_publish: bool = True) -> MonitoringService
**Purpose**: Convenience function to start monitoring in background.

**Parameters**:
- `check_interval` (int): Seconds between checks
- `auto_publish` (bool): Whether to auto-publish

**Returns**: MonitoringService instance

**Example**:
```python
from modules.ai_intelligence.work_completion_publisher import start_monitoring

# Start autonomous publishing
service = start_monitoring(auto_publish=True)

# Service runs in background, auto-publishing significant work
```

### Data Classes

#### WorkSession
Represents a work session being analyzed.

**Fields**:
- `session_id` (str): Unique session identifier
- `start_time` (datetime): When session started
- `files_changed` (List[str]): Modified files
- `files_added` (List[str]): New files
- `files_deleted` (List[str]): Removed files
- `total_changes` (int): Total number of changes
- `work_type` (str): Type of work ("feature", "fix", "docs", etc.)
- `significance_score` (float): Qwen-evaluated significance (0.0-1.0)

#### PublishContent
Content generated for publishing.

**Fields**:
- `commit_message` (str): Git commit message
- `linkedin_post` (str): LinkedIn post content
- `twitter_post` (str): X/Twitter post content
- `significance_score` (float): Significance score
- `metadata` (Dict[str, Any]): Additional metadata

## Integration Points

### main.py --git Integration

The publisher calls `main.py --git` which:
1. Commits changes to git
2. Pushes to remote repository
3. Posts to LinkedIn via social_media_orchestrator
4. Posts to X/Twitter via social_media_orchestrator

**Note**: Ensure main.py --git is configured and working before using auto-publish.

### Qwen Integration

Uses `holo_index.qwen_advisor.advisor.QwenAdvisor` for:
- Work significance evaluation
- Work type classification
- Content quality assessment

### Git Integration

Monitors git status via subprocess calls:
- `git status --porcelain` for file changes
- Detects staged and unstaged changes

## Configuration

### Significance Thresholds

```python
# In WorkAnalyzer
min_files_changed = 3        # Minimum files to consider publishing
min_minutes_worked = 15      # Minimum session duration
min_significance_score = 0.7 # Minimum Qwen score (0.0-1.0)
```

### Monitoring Intervals

```python
# In MonitoringService
check_interval = 300  # Check every 5 minutes
session_timeout = 1800  # Consider session ended after 30 min idle
```

## Error Handling

All methods implement robust error handling:
- Git command failures return empty status (no crash)
- Qwen evaluation failures fall back to heuristic scoring
- Publishing failures are logged but don't stop monitoring
- All exceptions are caught and logged

## Performance Characteristics

- **Qwen Evaluation**: ~500-1000ms per check
- **Git Status Check**: ~50-100ms per check
- **Memory Usage**: <10MB baseline
- **CPU Usage**: Minimal (only during checks)

## WSP Compliance

- **WSP 3**: Placed in ai_intelligence domain (autonomous decisions)
- **WSP 11**: Complete public API documentation
- **WSP 15**: MPS scoring for significance evaluation
- **WSP 34**: Git operations protocol compliance
- **WSP 49**: Full module structure with tests
- **WSP 50**: Pre-action verification of main.py existence
- **WSP 87**: HoloIndex integration for code context

## Testing

### Unit Tests
```bash
python -m pytest modules/ai_intelligence/work_completion_publisher/tests/ -v
```

### Integration Test
```bash
# Dry run - evaluates but doesn't publish
python modules/ai_intelligence/work_completion_publisher/src/work_analyzer.py
```

### Live Demo
```bash
# Runs monitoring for 2 minutes
python modules/ai_intelligence/work_completion_publisher/src/monitoring_service.py
```

## Dependencies

- Python 3.8+
- asyncio (stdlib)
- subprocess (stdlib)
- holo_index.qwen_advisor (local)
- git (system command)

## Future API Extensions

Planned additions:
- `set_publish_threshold(score: float)`: Dynamically adjust thresholds
- `get_publish_history()`: Retrieve publication history
- `predict_next_publish()`: Estimate when next publish likely
- `customize_content(template: str)`: Custom post templates
