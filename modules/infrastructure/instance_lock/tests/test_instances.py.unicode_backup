#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from modules.infrastructure.instance_lock.src.instance_manager import get_instance_lock

# === UTF-8 ENFORCEMENT (WSP 90) ===
# Prevent UnicodeEncodeError on Windows systems
if sys.platform.startswith('win'):
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8', errors='replace')
    sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8', errors='replace')
# === END UTF-8 ENFORCEMENT ===

def main():
    lock = get_instance_lock('youtube_monitor')
    summary = lock.get_instance_summary()

    print(f"üñ•Ô∏è  INSTANCE MONITORING TEST")
    print(f"Total YouTube DAE instances: {summary['total_instances']}")
    print(f"Current PID: {summary['current_pid']}")
    print()

    for instance in summary['instances']:
        status = "üè† CURRENT" if instance['is_current'] else "üö® OTHER"
        print(f"{status} PID {instance['pid']}")
        print(f"  ‚Ä¢ Started: {instance['start_time']}")
        print(f"  ‚Ä¢ Age: {instance['age_minutes']:.1f} minutes")
        print(f"  ‚Ä¢ Python: {instance['python_type']}")
        print(f"  ‚Ä¢ Memory: {instance['memory_mb']}")
        print(f"  ‚Ä¢ CPU: {instance['cpu_percent']}")
        print()

if __name__ == "__main__":
    main()
