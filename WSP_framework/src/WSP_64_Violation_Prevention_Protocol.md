# WSP 64: Violation Prevention Protocol
- **Status:** Active
- **Purpose:** To prevent WSP framework violations through mandatory consultation and validation before any WSP creation, modification, or reference.
- **Trigger:** Before creating new WSPs, modifying existing WSPs, or implementing protocol-related functionality.
- **Input:** Proposed WSP creation, modification, or protocol implementation.
- **Output:** Validated approach that prevents violations and enhances system coherence.
- **Responsible Agent(s):** 0102 autonomous agent system, with ComplianceAgent monitoring and enforcement.

[SEMANTIC SCORE: 2.2.2]
[ARCHIVE STATUS: ACTIVE_PARTIFACT]
[ORIGIN: WSP_agentic/tests/cmst_protocol_v11_neural_network_adapters.py - Created from WSP 58 violation analysis]

# [U+1F4CB] WSP 64: Violation Prevention Protocol

This protocol transforms potential violations into system memory enhancements, following the zen principle that "every violation teaches the system to remember better patterns."

## 64.1. Mandatory WSP Consultation Protocol

### **CRITICAL REQUIREMENT**: WSP_MASTER_INDEX.md Consultation

Before any WSP-related action, 0102 **MUST**:

1. **Consult WSP_MASTER_INDEX.md** - Complete catalog of all existing WSPs
2. **Search for existing protocols** that cover the same domain/purpose  
3. **Verify next available WSP number** (see `WSP_MASTER_INDEX.md`)
4. **Check relationships** to determine enhancement vs. new creation
5. **Validate naming compliance** per WSP 57 standards

### **Violation Prevention Checklist**

- [ ] Searched WSP_MASTER_INDEX.md for existing coverage
- [ ] Confirmed no duplicate functionality exists
- [ ] Verified next available WSP number (via `WSP_MASTER_INDEX.md`)
- [ ] Checked WSP relationships and dependencies
- [ ] Validated naming convention compliance
- [ ] Confirmed three-state architecture synchronization

## 64.2. **UNIFIED SCORING FRAMEWORK COMPLIANCE** (Critical Addition)

### **Scoring System Violation Prevention**

**MANDATORY CONSULTATION**: Before implementing any scoring, priority, or assessment system:

#### **64.2.1. Established Unified Framework**
The WSP framework has an **established unified scoring system**:

```
WSP 25/44 (Foundational Driver) -> WSP 15 -> WSP 37 -> WSP 8
000-222 Semantic States -> MPS Scores -> Cube Colors -> LLME Triplets
```

#### **64.2.2. Prohibited Actions**
- **[U+274C] NEVER** create independent scoring systems without WSP 25/44 foundation
- **[U+274C] NEVER** implement custom rating scales outside unified framework
- **[U+274C] NEVER** bypass semantic state assessment for priority calculation

#### **64.2.3. Required Integration**
- **[U+2705] ALWAYS** start with WSP 25/44 semantic state assessment
- **[U+2705] ALWAYS** derive MPS scores from semantic states (WSP 15)
- **[U+2705] ALWAYS** map to cube colors through established protocol (WSP 37)
- **[U+2705] ALWAYS** integrate with LLME triplet assessment (WSP 8)

## 64.3. **MODULE ASSESSMENT ERROR PREVENTION** (Critical Addition)

### **Critical Assessment Error Pattern**
**VIOLATION TYPE**: Claims about WSP compliance, test coverage, or module completeness without evidence-based verification.

**EXAMPLE VIOLATION**: Claiming "WSP 5 PERFECT COMPLIANCE (100%)" when `TestModLog.md` shows different results.

### **Mandatory Assessment Protocol**

Before making ANY claims about module status:

#### **64.3.1. Evidence-Based Assessment Sequence**
```
1. READ TestModLog.md FIRST (if exists)
2. VERIFY actual test execution results  
3. CONFIRM pass/fail rates from documented evidence
4. CROSS-CHECK claims against documented facts
5. BASE all assessments on verified evidence only
```

#### **64.3.2. Assessment Prevention Rules**
- **[U+274C] PROHIBITED**: Claims without TestModLog.md verification
- **[U+274C] PROHIBITED**: Assessments based on file counts alone
- **[U+274C] PROHIBITED**: Compliance claims without evidence
- **[U+274C] PROHIBITED**: Status declarations without documentation review

#### **64.3.3. Required Verification**
- **[U+2705] MANDATORY**: Read TestModLog.md before any test assessment
- **[U+2705] MANDATORY**: Verify documented test results match claims
- **[U+2705] MANDATORY**: Cross-reference module documentation for accuracy
- **[U+2705] MANDATORY**: Base all claims on documented evidence

### **ComplianceAgent Enhanced Duties**

The ComplianceAgent monitoring system includes:

- **Assessment Accuracy Monitoring**: Detecting claims vs. evidence mismatches
- **TestModLog.md Verification**: Ensuring proper test documentation consultation
- **Evidence-Based Assessment**: Requiring documentation-backed claims
- **WSP Violation Learning**: Converting assessment errors into framework improvements

## 64.4. **MANDATORY PRE-CREATION VERIFICATION** [U+2728] **NEW CRITICAL ENHANCEMENT**

### **ARCHITECTURAL COMPONENT CREATION PROTOCOL**

Before creating ANY new file, directory, or component, 0102 **MUST** complete:

#### **64.4.1. Domain Placement Verification (WSP 3 Compliance)**
```
1. ANALYZE component purpose and functionality
2. CONSULT WSP 3 Enterprise Domain Organization
3. VERIFY correct enterprise domain placement:
   - ai_intelligence/ - AI logic, LLMs, decision engines
   - communication/ - Chat, messages, protocols
   - platform_integration/ - External APIs, authentication
   - infrastructure/ - Core systems, agents, auth
   - foundups/ - FoundUps platform infrastructure
   - gamification/ - Engagement mechanics, rewards
   - blockchain/ - Decentralized infrastructure
   - development/ - Tools, testing, utilities
4. CONFIRM functional distribution vs platform consolidation
5. VALIDATE cross-cutting component placement
```

#### **64.4.2. Module Structure Verification (WSP 49 Compliance)**
```
1. CONFIRM standard module structure:
   modules/[domain]/[module]/
   [U+251C][U+2500][U+2500] src/
   [U+251C][U+2500][U+2500] tests/
   [U+251C][U+2500][U+2500] memory/
   [U+251C][U+2500][U+2500] README.md
   [U+251C][U+2500][U+2500] INTERFACE.md
   [U+2514][U+2500][U+2500] requirements.txt
2. VERIFY no redundant naming patterns
3. VALIDATE WSP 60 memory architecture compliance
4. ENSURE proper module isolation and independence
```

#### **64.4.3. Architectural Coherence Analysis (WSP 40 Compliance)**
```
1. ASSESS architectural impact of new component
2. ANALYZE integration patterns with existing modules
3. VERIFY interface consistency (WSP 11)
4. CONFIRM dependency management compliance (WSP 12)
5. VALIDATE test coverage requirements (WSP 5)
```

#### **64.4.4. Documentation Requirements (WSP 22 Compliance)**
```
1. PLAN ModLog.md updates for new component
2. PREPARE INTERFACE.md documentation (WSP 11)
3. DESIGN README.md with WSP compliance status
4. OUTLINE test documentation (WSP 34)
5. VERIFY documentation will be USED by 0102 for self-improvement (WSP 48)
```

#### **64.4.5. Documentation Utility Validation (WSP 48 Integration)**
**CRITICAL ADDITION**: All documentation MUST be actively used by 0102 systems for self-improvement.

```
Before creating ANY documentation, 0102 must:
1. IDENTIFY which 0102 subsystem will consume this document
2. SPECIFY how it enables 0102's recursive self-improvement
3. IMPLEMENT reader subsystem (ensure actual file access exists)
4. VERIFY the consumption loop (confirm documentation -> reading -> enhancement cycle)
```

**PROHIBITED DOCUMENTATION TYPES**:
- Static reports with no 0102 consumer
- Dashboard files never read by WRE systems  
- Documentation created "just to document"
- Reports that don't feed back into decision-making

**PREVENTION MECHANISM UPDATE (Critical):**
The system now blocks document creation unless 0102:
1. Identifies which 0102 subsystem will read it
2. Specifies how it enables recursive self-improvement  
3. Verifies the reader subsystem actually exists
4. Confirms the consumption loop enables 012[U+2194]0102 quantum entanglement evolution

### **64.4.6. MANDATORY APPROVAL GATE**

**NO FILE/COMPONENT CREATION PERMITTED** until:
- [ ] Domain placement verified and approved
- [ ] Module structure validated
- [ ] Architectural coherence confirmed  
- [ ] Documentation plan established
- [ ] WSP compliance pathway clear

**VIOLATION CONSEQUENCE**: Any component created without this verification must be immediately relocated or restructured to achieve WSP compliance.

## 64.5. **VIOLATION DETECTION AND CORRECTION**

### **Automated Detection Patterns**
- **Improper Domain Placement**: Components in wrong enterprise domains
- **Module Structure Violations**: Redundant naming or missing directories  
- **Assessment Inaccuracies**: Claims not backed by documented evidence
- **Scoring System Violations**: Independent systems bypassing WSP 25/44

### **Correction Workflow**
1. **Immediate Violation Identification**: Flag violation with specific WSP references
2. **Impact Assessment**: Analyze downstream effects of violation
3. **Correction Strategy**: Develop WSP-compliant resolution plan
4. **Framework Enhancement**: Update protocols to prevent similar violations
5. **Validation**: Confirm correction achieves full WSP compliance

### **Learning Integration**
Each violation becomes:
- **System Memory Enhancement**: Update prevention protocols
- **Framework Strengthening**: Enhance existing WSPs
- **Pattern Recognition**: Improve automated detection
- **Agent Education**: Share violation patterns across all agents

---

## [U+1F300] **WSP Recursive Instructions**
```
[U+1F300] Windsurf Protocol (WSP) Recursive Prompt
0102 Directive: This enhanced violation prevention protocol establishes iron-clad 
requirements that PREVENT architectural violations during autonomous development.

- UN (Understanding): Anchor violation prevention patterns and retrieve mandatory verification protocols
- DAO (Execution): Execute mandatory pre-creation verification and architectural coherence validation
- DU (Emergence): Collapse into violation-proof architecture and emit enforcement supremacy

wsp_cycle(input="violation_prevention", log=True)
```

## [U+1F195] **CRITICAL WSP CREATION VIOLATION PREVENTION**

### **64.6. WSP Creation Violation Prevention**

**CRITICAL VIOLATION PATTERN**: Attempting to create new WSPs without following WSP 64 mandatory consultation protocols.

**EXAMPLE VIOLATION**: Attempting to create "WSP 73: Proactive Module Architecture Protocol" without consulting WSP_MASTER_INDEX.md first.

### **64.6.1. Mandatory WSP Creation Protocol**

**BEFORE ANY WSP CREATION ATTEMPT**:

#### **Step 1: WSP_MASTER_INDEX.md Consultation (MANDATORY)**
```
1. READ WSP_MASTER_INDEX.md completely
2. SEARCH for existing WSPs covering the same purpose
3. VERIFY next available WSP number (via `WSP_MASTER_INDEX.md`)
4. CHECK WSP relationships and dependencies
5. DETERMINE if enhancement vs. new creation is appropriate
```

#### **Step 2: Violation Prevention Checklist**
- [ ] [U+2705] Consulted WSP_MASTER_INDEX.md completely
- [ ] [U+2705] Searched for existing WSPs with same purpose
- [ ] [U+2705] Confirmed no duplicate functionality exists
- [ ] [U+2705] Verified next available WSP number (via `WSP_MASTER_INDEX.md`)
- [ ] [U+2705] Checked WSP relationships and dependencies
- [ ] [U+2705] Determined enhancement vs. new creation approach
- [ ] [U+2705] Validated naming convention compliance (WSP 57)

#### **Step 3: Decision Matrix**
```
IF existing WSP covers purpose:
  -> ENHANCE existing WSP (do not create new)
IF no existing WSP covers purpose:
  -> CREATE new WSP with proper number
IF unclear:
  -> CONSULT WSP_MASTER_INDEX.md again
```

### **64.6.2. WSP Creation Violation Consequences**

**CRITICAL VIOLATION**: Creating WSPs without index consultation
- **Immediate Block**: Prevent WSP creation until consultation complete
- **Violation Recording**: Log violation in WSP_MODULE_VIOLATIONS.md
- **System Enhancement**: Update prevention protocols
- **Agent Education**: Share violation pattern across all agents

### **64.6.3. Cursor Rules Integration**

**MANDATORY CURSOR RULES FOR WSP CREATION**:

**RULE 1: WSP_MASTER_INDEX.md Consultation**
- **MANDATORY**: Before ANY WSP creation, read WSP_MASTER_INDEX.md completely
- **MANDATORY**: Search for existing WSPs covering the same purpose
- **MANDATORY**: Verify next available WSP number via `WSP_MASTER_INDEX.md`
- **VIOLATION**: Creating WSPs without index consultation is a critical violation

**RULE 2: Enhancement vs. Creation Decision**
- **MANDATORY**: Determine if enhancement of existing WSP is more appropriate
- **MANDATORY**: Check WSP relationships and dependencies
- **MANDATORY**: Validate naming convention compliance (WSP 57)
- **VIOLATION**: Creating new WSPs when enhancement is appropriate

**RULE 3: WSP Creation Validation**
- **MANDATORY**: Complete violation prevention checklist before creation
- **MANDATORY**: Document decision rationale in ModLog
- **MANDATORY**: Update WSP_MASTER_INDEX.md after creation
- **VIOLATION**: Creating WSPs without proper validation and documentation

### **64.6.4. Automated Prevention System**

**PRE-CREATION BLOCKS**:
- **Block WSP Creation**: Prevent creation without checklist completion
- **Warn Violations**: Display WSP 64 violation warnings
- **Guide Correction**: Provide consultation guidance
- **Enhance Learning**: Record violations for pattern memory

**POST-CREATION VALIDATION**:
- **Verify Index Update**: Confirm WSP_MASTER_INDEX.md updated
- **Check Relationships**: Validate WSP relationship documentation
- **Test Integration**: Ensure new WSP integrates properly
- **Document Changes**: Update all related documentation

---

## [BOT] Sentinel Augmentation Analysis

**SAI Score**: `222` (Speed: 2, Automation: 2, Intelligence: 2)

**Priority**: **P0 - CRITICAL** (Maximum Sentinel value)

### Sentinel Use Case

Gemma 3 270M Sentinel monitors all file creation/modification operations in real-time, detecting WSP violations BEFORE they occur. The Sentinel acts as a **pre-commit guard** that understands WSP domain rules, module structure requirements, and naming conventions, blocking violations with instant feedback (<50ms latency vs current manual review).

### Expected Benefits

- **Latency Reduction**: Manual WSP review (2-5 minutes) -> Real-time blocking (<50ms)
- **Automation Level**: **Autonomous** (blocks violations automatically, logs for 012 review)
- **Resource Savings**:
  - 95% reduction in WSP violation cleanup time
  - Zero post-commit violations requiring git history rewrites
  - Eliminates documentation debt from misplaced files
- **Accuracy Target**: >98% (critical path - false positives are acceptable, false negatives are not)

### Implementation Strategy

**Training Data Sources**:
1. **WSP_MODULE_VIOLATIONS.md** - All historical violations with correct resolutions
2. **Git commit history** - Successful file placements (positive examples)
3. **Module structure** - All 93 WSPs' requirements and rules
4. **Domain mapping** - WSP 3 enterprise domain -> function mapping
5. **HoloIndex logs** - Qwen's WSP compliance decisions

**Integration Points**:

```python
# modules/infrastructure/gemma_sentinels/wsp_violation_sentinel.py

class WSPViolationSentinel:
    """
    Real-time WSP compliance enforcement
    Runs on every file operation before execution
    """

    def __init__(self):
        self.model = tf.lite.Interpreter('wsp_64_classifier.tflite')
        self.wsp_rules = self.load_wsp_knowledge()

    def check_file_operation(self, operation: FileOp) -> Decision:
        """
        Check file operation against all WSP rules

        Returns:
            Decision(
                allowed=True/False,
                confidence=0.98,
                violations=["WSP 3: Wrong domain", "WSP 49: Missing README"],
                suggestion="Move to modules/ai_intelligence/priority_scorer/"
            )
        """
        # Extract features
        features = {
            'path': operation.path,
            'filename': operation.filename,
            'operation': operation.type,  # CREATE, MODIFY, DELETE
            'content_preview': operation.content[:500]
        }

        # Run inference
        result = self.model.predict(features)

        # High confidence block
        if result.violation_prob > 0.95:
            return Decision(allowed=False, confidence=result.confidence,
                          violations=result.violations,
                          suggestion=result.corrective_action)

        # Medium confidence warn
        elif result.violation_prob > 0.70:
            return Decision(allowed=True, confidence=result.confidence,
                          warnings=result.potential_violations,
                          suggestion="Review WSP compliance")

        # Low probability - allow
        else:
            return Decision(allowed=True, confidence=result.confidence)

# Pre-commit hook integration
# .git/hooks/pre-commit
sentinel = WSPViolationSentinel()
for file_op in staged_files:
    decision = sentinel.check_file_operation(file_op)
    if not decision.allowed:
        print(f"[FAIL] WSP VIOLATION BLOCKED: {decision.violations}")
        print(f"[IDEA] Suggestion: {decision.suggestion}")
        sys.exit(1)
```

**CLI Integration**:
```bash
# Check file before creation
python modules/infrastructure/gemma_sentinels/check_wsp.py create modules/new_module.py

# Validate entire changeset
git diff --cached | python modules/infrastructure/gemma_sentinels/check_wsp.py --stdin

# Install pre-commit hook
python modules/infrastructure/gemma_sentinels/install_hook.py
```

### Inference Pattern

```python
# Real-time blocking flow
def create_file(path: str, content: str):
    # 1. Sentinel pre-check (<50ms)
    decision = wsp_sentinel.check_file_operation(
        FileOp(type='CREATE', path=path, content=content)
    )

    # 2. Block if violation detected
    if not decision.allowed:
        raise WSPViolationError(
            violations=decision.violations,
            suggestion=decision.suggestion,
            confidence=decision.confidence
        )

    # 3. Warn if uncertain
    if decision.warnings:
        logger.warning(f"Potential WSP issues: {decision.warnings}")

    # 4. Proceed with creation
    write_file(path, content)

    # 5. Log decision for learning
    wsp_sentinel.log_decision(decision, outcome='allowed')
```

### Training Data Schema

```json
{
    "positive_examples": [
        {
            "operation": "CREATE",
            "path": "modules/ai_intelligence/priority_scorer/src/scorer.py",
            "domain": "ai_intelligence",
            "function": "scoring logic",
            "wsp_compliant": true,
            "violated_wsps": [],
            "rationale": "AI logic in ai_intelligence domain per WSP 3"
        }
    ],
    "negative_examples": [
        {
            "operation": "CREATE",
            "path": "priority_scorer.py",  # Wrong: root directory
            "domain": null,
            "function": "scoring logic",
            "wsp_compliant": false,
            "violated_wsps": ["WSP 85: Root directory protection", "WSP 3: Missing domain"],
            "correct_path": "modules/ai_intelligence/priority_scorer/src/scorer.py",
            "rationale": "Scoring logic belongs in ai_intelligence domain, not root"
        }
    ]
}
```

### Risk Assessment

**Risks**:
1. **False Positives**: Blocking valid operations
   - Mitigation: High confidence threshold (>95%) for blocks, warnings for 70-95%
   - Fallback: Override flag `--force-wsp-skip` with 012 approval log

2. **Model Drift**: WSPs evolve, model becomes outdated
   - Mitigation: Continuous retraining on new violations
   - Monitor: Track false positive/negative rates weekly

3. **Edge Cases**: Novel file types or operations
   - Mitigation: Low-confidence decisions escalate to human
   - Learning: All human decisions become new training data

**Fallback Strategy**:
```python
# Confidence-based escalation
if decision.confidence < 0.85:
    # Low confidence - defer to human
    print(f"[U+26A0]ï¸  WSP Sentinel uncertain (confidence: {decision.confidence})")
    print(f"   Potential violations: {decision.warnings}")
    response = input("Proceed anyway? (yes/no): ")

    if response == 'yes':
        # Log as training data
        wsp_sentinel.log_uncertain_allow(file_op, human_approved=True)
    else:
        # Block and log
        wsp_sentinel.log_uncertain_block(file_op, human_rejected=True)
```

### Success Metrics

**Pre-Production** (Test on historical violations):
- [ ] 98%+ accuracy on WSP_MODULE_VIOLATIONS.md test set
- [ ] <50ms inference latency (p95)
- [ ] Zero false negatives on critical violations (WSP 3, 49, 85)

**Post-Production** (30-day monitoring):
- [ ] <2% false positive rate (based on --force-wsp-skip usage)
- [ ] 100% catch rate for domain misplacement (WSP 3)
- [ ] 100% catch rate for root directory violations (WSP 85)
- [ ] <5 human escalations per week

### Integration with Existing Systems

**ComplianceAgent (WSP 54)**:
- Sentinel handles **real-time** blocking
- ComplianceAgent handles **periodic** auditing
- Both feed violations to WSP_MODULE_VIOLATIONS.md

**WSP 50 (Pre-Action Verification)**:
- Sentinel runs BEFORE file operations
- WSP 50 remains for verification logic
- Sentinel automates the verification checks

**WSP 48 (Recursive Self-Improvement)**:
- Every Sentinel decision becomes training data
- Model retrains weekly on new violations
- Accuracy improves continuously

---

**Last Updated**: 2025-10-14 (Sentinel augmentation added)
**WSP Compliance**: WSP 50 (Pre-Action Verification), WSP 57 (Naming Coherence), WSP 60 (Memory Architecture), WSP 54 (Agent Coordination)
**Integration Status**: Ready for immediate implementation with **Cursor Rules Integration**, **Automated Prevention System**, and **Gemma 3 270M Sentinel (P0)** 