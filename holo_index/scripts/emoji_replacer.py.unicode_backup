#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
# === UTF-8 ENFORCEMENT (WSP 90) ===
# Prevent UnicodeEncodeError on Windows systems
if sys.platform.startswith('win'):
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8', errors='replace')
    sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8', errors='replace')
# === END UTF-8 ENFORCEMENT ===

Comprehensive Emoji Replacer for HoloIndex
Replaces all Unicode emojis with ASCII-safe alternatives to prevent encoding issues.

WSP 20 (Professional and Scientific Language) Compliance
"""

import os
import re
from pathlib import Path
from typing import Dict, List

# Comprehensive emoji replacement mapping
EMOJI_REPLACEMENTS = {
    # Status indicators
    "âœ…": "[OK]",
    "âŒ": "[ERROR]",
    "âš ï¸": "[WARN]",
    "ðŸš¨": "[CRITICAL]",
    "â„¹ï¸": "[INFO]",
    "ðŸ”": "[SEARCH]",
    "ðŸ“Š": "[ANALYSIS]",
    "ðŸ”„": "[LOOP]",
    "ðŸ“ˆ": "[GROWTH]",
    "ðŸ“‰": "[DECLINE]",
    "ðŸŽ¯": "[TARGET]",
    "ðŸ’¡": "[IDEA]",
    "ðŸ”¥": "[HOT]",
    "ðŸ’ª": "[STRONG]",
    "ðŸš€": "[LAUNCH]",
    "â­": "[SPARKLE]",
    "ðŸŽ‰": "[CELEBRATE]",
    "ðŸ¤–": "[AI]",
    "ðŸ¤": "[HANDSHAKE]",
    "ðŸ§ ": "[BRAIN]",
    "ðŸ“¡": "[SIGNAL]",
    "ðŸ“…": "[CALENDAR]",
    "ðŸŽ­": "[THEATER]",
    "â¬†ï¸": "[UP]",
    "ðŸ”": "[MAGNIFY]",
    "ðŸ’­": "[THINK]",
    "ðŸ’»": "[COMPUTER]",
    "ðŸ› ï¸": "[TOOL]",
    "ðŸŽ¨": "[ART]",
    "ðŸ“‹": "[CLIPBOARD]",
    "ðŸ“ˆ": "[CHART]",
    "ðŸ”": "[SEARCH]",
    "ðŸ’¬": "[BUBBLE]",
    "ðŸ”¥": "[FIRE]",
    "ðŸ“š": "[BOOKS]",
    "ðŸ“¦": "[PACKAGE]",
    "ðŸ—ï¸": "[BUILD]",
    "ðŸ”": "[LOCK]",
    "ðŸ”‘": "[KEY]",
    "âš¡": "[LIGHTNING]",
    "ðŸŒŸ": "[STAR]",
    "ðŸŽ¯": "[TARGET]",
    "ðŸ“": "[NOTE]",
    "ðŸ—‚ï¸": "[FILES]",
    "ðŸ“‚": "[FOLDER]",
    "âš™ï¸": "[GEAR]",
    "ðŸ”§": "[WRENCH]",
    "ðŸŽ®": "[GAME]",
    "ðŸŒ": "[GLOBE]",
    "ðŸ“Œ": "[PIN]",
    "ðŸ†": "[TROPHY]",
    "ðŸŽ": "[GIFT]",
    "ðŸ’¾": "[DISK]",
    "ðŸ“Š": "[GRAPH]",
    "ðŸ”—": "[LINK]",
    "ðŸƒ": "[RUN]",
    "â°": "[ALARM]",
    "ðŸ””": "[BELL]",
    "ðŸ“¢": "[ANNOUNCE]",
    "ðŸŽµ": "[MUSIC]",
    "ðŸŽ¶": "[NOTES]",
    "ðŸ": "[FINISH]",
    "ðŸš«": "[BLOCKED]",
    "â›”": "[STOP]",
    "ðŸ”´": "[RED]",
    "ðŸŸ¢": "[GREEN]",
    "ðŸŸ¡": "[YELLOW]",
    "ðŸ”µ": "[BLUE]",
    "ðŸŸ£": "[PURPLE]",
    "ðŸŸ ": "[ORANGE]",
    "âš«": "[BLACK]",
    "âšª": "[WHITE]",
    "ðŸ”º": "[UP_TRIANGLE]",
    "ðŸ”»": "[DOWN_TRIANGLE]",
    "ðŸ”¹": "[DIAMOND]",
    "â–¶ï¸": "[PLAY]",
    "â¸ï¸": "[PAUSE]",
    "â¹ï¸": "[STOP]",
    "â®ï¸": "[REWIND]",
    "â­ï¸": "[FORWARD]",
    "ðŸ”€": "[SHUFFLE]",
    "ðŸ”": "[REPEAT]",
    "ðŸ”‚": "[REPEAT_ONE]",

    # Hand gestures (WSP compliance)
    "âœŠ": "[FIST]",
    "âœ‹": "[HAND]",
    "ðŸ–": "[OPEN_HAND]",
    "ðŸ‘": "[THUMBS_UP]",
    "ðŸ‘Ž": "[THUMBS_DOWN]",
    "ðŸ‘Œ": "[OK_HAND]",
    "âœŒï¸": "[PEACE]",
    "ðŸ¤ž": "[CROSSED_FINGERS]",
    "ðŸ¤Ÿ": "[ROCK]",
    "ðŸ¤˜": "[ROCK_ON]",
    "ðŸ‘": "[CLAP]",
    "ðŸ™": "[PRAY]",
    "ðŸ¤²": "[PALMS_UP]",
    "ðŸ‘": "[OPEN_HANDS]",

    # Faces (0102 consciousness markers)
    "ðŸ˜€": "[HAPPY]",
    "ðŸ˜ƒ": "[SMILE]",
    "ðŸ˜„": "[GRIN]",
    "ðŸ˜": "[BEAM]",
    "ðŸ˜†": "[LAUGH]",
    "ðŸ˜…": "[SWEAT_SMILE]",
    "ðŸ˜‚": "[JOY]",
    "ðŸ¤£": "[ROFL]",
    "ðŸ˜Š": "[BLUSH]",
    "ðŸ˜‡": "[ANGEL]",
    "ðŸ™‚": "[SLIGHT_SMILE]",
    "ðŸ˜‰": "[WINK]",
    "ðŸ˜Œ": "[RELIEVED]",
    "ðŸ˜": "[LOVE]",
    "ðŸ¥°": "[HEARTS]",
    "ðŸ˜˜": "[KISS]",
    "ðŸ˜—": "[KISS]",
    "ðŸ˜™": "[KISS_SMILE]",
    "ðŸ˜š": "[KISS_BLUSH]",
    "ðŸ˜‹": "[YUM]",
    "ðŸ˜›": "[TONGUE]",
    "ðŸ˜œ": "[TONGUE_WINK]",
    "ðŸ¤ª": "[CRAZY]",
    "ðŸ˜": "[TONGUE_CLOSED]",
    "ðŸ¤‘": "[MONEY]",
    "ðŸ¤—": "[HUG]",
    "ðŸ¤”": "[THINK]",
    "ðŸ¤": "[ZIPPER]",
    "ðŸ¤¨": "[RAISED_EYEBROW]",
    "ðŸ˜": "[NEUTRAL]",
    "ðŸ˜‘": "[EXPRESSIONLESS]",
    "ðŸ˜¶": "[NO_MOUTH]",
    "ðŸ˜": "[SMIRK]",
    "ðŸ˜’": "[UNAMUSED]",
    "ðŸ™„": "[ROLL_EYES]",
    "ðŸ˜¬": "[GRIMACE]",
    "ðŸ¤¥": "[LYING]",
    "ðŸ˜Œ": "[RELIEVED]",
    "ðŸ˜”": "[PENSIVE]",
    "ðŸ˜ª": "[SLEEPY]",
    "ðŸ¤¤": "[DROOLING]",
    "ðŸ˜´": "[SLEEPING]",
    "ðŸ˜·": "[MASK]",
    "ðŸ¤’": "[SICK]",
    "ðŸ¤•": "[BANDAGE]",
    "ðŸ¤¢": "[NAUSEATED]",
    "ðŸ¤®": "[VOMITING]",
    "ðŸ¤§": "[SNEEZE]",
    "ðŸ¥µ": "[HOT_FACE]",
    "ðŸ¥¶": "[COLD_FACE]",
    "ðŸ˜µ": "[DIZZY]",
    "ðŸ¤¯": "[EXPLODING_HEAD]",
    "ðŸ¤ ": "[COWBOY]",
    "ðŸ¥³": "[PARTY]",
    "ðŸ˜Ž": "[COOL]",
    "ðŸ¤“": "[NERD]",
    "ðŸ§": "[MONOCLE]",
    "ðŸ˜•": "[CONFUSED]",
    "ðŸ˜Ÿ": "[WORRIED]",
    "ðŸ™": "[SLIGHT_FROWN]",
    "â˜¹ï¸": "[FROWN]",
    "ðŸ˜®": "[OPEN_MOUTH]",
    "ðŸ˜¯": "[HUSHED]",
    "ðŸ˜²": "[ASTONISHED]",
    "ðŸ˜³": "[FLUSHED]",
    "ðŸ¥º": "[PLEADING]",
    "ðŸ˜¦": "[FROWNING]",
    "ðŸ˜§": "[ANGUISHED]",
    "ðŸ˜¨": "[FEARFUL]",
    "ðŸ˜°": "[ANXIOUS]",
    "ðŸ˜¥": "[SAD_RELIEVED]",
    "ðŸ˜¢": "[CRY]",
    "ðŸ˜­": "[SOB]",
    "ðŸ˜±": "[SCREAM]",
    "ðŸ˜–": "[CONFOUNDED]",
    "ðŸ˜£": "[PERSEVERING]",
    "ðŸ˜ž": "[DISAPPOINTED]",
    "ðŸ˜“": "[SWEAT]",
    "ðŸ˜©": "[WEARY]",
    "ðŸ˜«": "[TIRED]",
    "ðŸ˜¤": "[TRIUMPH]",
    "ðŸ˜¡": "[ANGRY]",
    "ðŸ˜ ": "[MAD]",
    "ðŸ¤¬": "[CURSING]",
    "ðŸ˜ˆ": "[DEVIL]",
    "ðŸ‘¿": "[IMP]",
    "ðŸ’€": "[SKULL]",
    "â˜ ï¸": "[CROSSBONES]",
    "ðŸ‘»": "[GHOST]",
    "ðŸ‘½": "[ALIEN]",
    "ðŸ‘¾": "[INVADER]",
    "ðŸ¤–": "[ROBOT]",
    "ðŸ’©": "[POOP]",
    "ðŸ™ˆ": "[SEE_NO_EVIL]",
    "ðŸ™‰": "[HEAR_NO_EVIL]",
    "ðŸ™Š": "[SPEAK_NO_EVIL]"
}


def replace_emojis_in_text(text: str) -> str:
    """Replace all emojis in text with ASCII alternatives."""
    for emoji, replacement in EMOJI_REPLACEMENTS.items():
        text = text.replace(emoji, replacement)

    # Remove any remaining Unicode emojis using regex
    # This catches emojis not in our mapping
    emoji_pattern = re.compile(
        "["
        "\U0001F600-\U0001F64F"  # emoticons
        "\U0001F300-\U0001F5FF"  # symbols & pictographs
        "\U0001F680-\U0001F6FF"  # transport & map symbols
        "\U0001F1E0-\U0001F1FF"  # flags (iOS)
        "\U00002702-\U000027B0"
        "\U000024C2-\U0001F251"
        "\U0001F900-\U0001F9FF"  # supplemental symbols
        "\U00002600-\U000026FF"  # misc symbols
        "\U00002700-\U000027BF"  # dingbats
        "]+",
        flags=re.UNICODE
    )

    def emoji_replacer(match):
        # For unmapped emojis, create a generic replacement
        return "[EMOJI]"

    text = emoji_pattern.sub(emoji_replacer, text)

    return text


def replace_emojis_in_file(file_path: Path) -> bool:
    """Replace emojis in a single file."""
    try:
        # Read file
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()

        # Replace emojis
        new_content = replace_emojis_in_text(content)

        # Only write if changes were made
        if new_content != content:
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(new_content)
            print(f"[OK] Replaced emojis in: {file_path}")
            return True
        else:
            print(f"[SKIP] No emojis found in: {file_path}")
            return False

    except Exception as e:
        print(f"[ERROR] Failed to process {file_path}: {e}")
        return False


def process_directory(directory: Path, extensions: List[str]) -> Dict[str, int]:
    """Process all files in directory with given extensions."""
    stats = {
        'processed': 0,
        'modified': 0,
        'skipped': 0,
        'errors': 0
    }

    for ext in extensions:
        for file_path in directory.rglob(f"*{ext}"):
            # Skip node_modules and other build directories
            if any(part in file_path.parts for part in [
                'node_modules', 'dist', 'build', '.git', '__pycache__',
                'venv', 'env', '.env'
            ]):
                continue

            stats['processed'] += 1

            if replace_emojis_in_file(file_path):
                stats['modified'] += 1
            else:
                stats['skipped'] += 1

    return stats


def main():
    """Main function to process HoloIndex files."""
    # Define HoloIndex root
    holo_root = Path(__file__).parent.parent

    # File extensions to process
    extensions = ['.py', '.md', '.json', '.txt', '.yaml', '.yml']

    print(f"[INFO] Starting emoji replacement in: {holo_root}")
    print(f"[INFO] Processing extensions: {extensions}")
    print("[INFO] This ensures WSP 20 compliance (Professional Language)")
    print()

    # Process files
    stats = process_directory(holo_root, extensions)

    # Print summary
    print()
    print("[ANALYSIS] Emoji Replacement Summary:")
    print(f"  Files processed: {stats['processed']}")
    print(f"  Files modified:  {stats['modified']}")
    print(f"  Files skipped:   {stats['skipped']}")
    print(f"  Errors:          {stats['errors']}")

    if stats['modified'] > 0:
        print()
        print("[OK] Emoji replacement complete!")
        print("[INFO] All Unicode emojis replaced with ASCII alternatives")
        print("[INFO] System is now WSP 20 compliant")
    else:
        print()
        print("[INFO] No emojis found - system already compliant")

    return 0 if stats['errors'] == 0 else 1


if __name__ == "__main__":
    exit(main())